<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Using IPython Notebook with Apache Spark | Crash Course on Apache Spark</title>

    <!-- Styles and fonts -->
    <link href="themes/glide/stylesheets/glide.css" rel="stylesheet" type="text/css" />
    <link href="themes/glide/stylesheets/syntax.css" rel="stylesheet" type="text/css" />
    <link href='//fonts.googleapis.com/css?family=Bree+Serif&subset=latin,latin-ext' rel='stylesheet' type='text/css'>

    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

    <script src="themes/glide/javascripts/modernizr.js" type="text/javascript"></script>
  </head>

  <body class="x025-ipython-notebook-with-apache-spark glide">
    <div class="page-wrapper">

      <!--[if lt IE 7]>
          <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
      <![endif]-->

      <header class="page-header" role="banner">
<a class="invisilink" href="./">            <span class="book-title">Crash Course on Apache Spark</span>
</a>        <span class="book-author visuallyhidden">by <a href="http://linkedin.com/in/saptak">Saptak Sen</a></span>
      </header>

        <div class="content-wrapper clearfix">

          <section class="main-content" role="main">
            <div class="main-content-source">
              <h1>Using IPython Notebook with Apache Spark</h1>

<p>In this tutorial we are going to configure IPython notebook with Apache Spark on YARN in a few steps.</p>

<p>IPython notebook is an interactive Python shell which lets you interact with your data one step at a time and also perform simple visualizations.</p>

<p>IPython notebook supports tab autocompletion on class names, functions, methods, variables. It also offers more explicit and colour-highlighted error messages than the command line python shell. It provides integration with basic UNIX shell allowing you can run simple shell commands such as cp, ls, rm, cp, etc. directly from the IPython. IPython integrates with many common GUI modules like PyQt, PyGTK, tkinter as well wide variety of data science Python packages.</p>

<h3>Prerequisites</h3>

<p>The only prerequiste for this tutorial is the latest <a href="http://hortonworks.com/sandbox">Hortonworks Sandbox</a> installed on your computer or on the <a href="http://hortonworks.com/blog/hortonworks-sandbox-azure/">cloud</a>. In case you are running an Hortonworks Sandbox with an earlier version of Apache Spark, for the instruction in this tutorial, you need to install the Apache Spark 1.3.1.</p>

<h3>Installing and configuring IPython</h3>

<p>To begin, login in to Hortonworks Sandbox through SSH:<img src="https://www.dropbox.com/s/tzsxvsnxfo26jn7/Screenshot_2015-04-13_07_58_43.png?dl=1" />The default password is <code>hadoop</code>.</p>

<p>Now let’s configure the dependencies by typing in the following command:</p>
<pre class="highlight shell">yum install nano centos-release-SCL zlib-devel <span class="se">\</span>
bzip2-devel openssl-devel ncurses-devel <span class="se">\</span>
sqlite-devel readline-devel tk-devel <span class="se">\</span>
gdbm-devel db4-devel libpcap-devel xz-devel <span class="se">\</span>
libpng-devel libjpg-devel atlas-devel
</pre>

<p><img src="https://www.dropbox.com/s/f2ebp87ed2mllms/Screenshot%202015-07-20%2010.04.16.png?dl=1" /></p>

<p>IPython has a requirement for Python 2.7 or higher. So, let&rsquo;s install the &ldquo;Development tools&rdquo; dependency for Python 2.7</p>
<pre class="highlight shell">yum groupinstall <span class="s2">"Development tools"</span>
</pre>

<p><img src="https://www.dropbox.com/s/fubupr8ivfuff0o/Screenshot%202015-07-20%2010.08.06.png?dl=1" /></p>

<p>Now we are ready to install Python 2.7.</p>
<pre class="highlight shell">yum install python27
</pre>

<p><img src="https://www.dropbox.com/s/jpmuio6y4cwyho2/Screenshot%202015-07-20%2010.09.55.png?dl=1" /></p>

<p>Now the Sandbox has multiple versions of Python, so we have to select which version of Python we want to use in this session. We will choose to use Python 2.7 in this session.</p>
<pre class="highlight shell"><span class="nb">source</span> /opt/rh/python27/enable
</pre>

<p>Then we will download <code>easy_install</code> which we will use to configure <code>pip</code>, a Python package installer.</p>
<pre class="highlight shell">wget https://bitbucket.org/pypa/setuptools<span class="se">\</span>
/raw/bootstrap/ez_setup.py
</pre>

<p>Now let&rsquo;s configure <code>easy_install</code> with the following command:</p>
<pre class="highlight shell">python ez_setup.py
</pre>

<p>Now we can install <code>pip</code> with <code>easy_install</code> using the following command:</p>
<pre class="highlight shell">easy_install-2.7 pip
</pre>

<p><img src="https://www.dropbox.com/s/c9wou8cgctlf7pz/Screenshot%202015-07-20%2010.21.02.png?dl=1" /></p>

<p><code>pip</code> makes it really easy to install the Python packages. We will use <code>pip</code> to install the data science packages we might need using the following command:</p>
<pre class="highlight shell">pip install numpy scipy pandas <span class="se">\</span>
scikit-learn tornado pyzmq <span class="se">\</span>
pygments matplotlib jinja2 jsonschema
</pre>

<p><img src="https://www.dropbox.com/s/ves4gqmtz7acsux/Screenshot%202015-07-20%2010.58.32.png?dl=1" /></p>

<p>Finally, we are ready to install IPython notebook using <code>pip</code> using the following command:</p>
<pre class="highlight shell">pip install <span class="s2">"ipython[notebook]"</span>
</pre>

<p><img src="https://www.dropbox.com/s/k8brxy9dgik6ohw/Screenshot%202015-07-20%2011.00.00.png?dl=1" /></p>

<h3>Configuring IPython</h3>

<p>Since we want to use IPython with Apache Spark we have to use the Python interpreter which is built with Apache Spark, <code>pyspark</code>, instead of the default Python interpreter.</p>

<p>As a first step of configuring that, let&rsquo;s create a IPython profile for <code>pyspark</code></p>
<pre class="highlight shell">ipython profile create pyspark
</pre>

<p><img src="https://www.dropbox.com/s/2klc4095wrxyz5d/Screenshot%202015-07-20%2011.01.58.png?dl=1" /></p>

<p>Within the this newly minted IPython profile for <code>pyspark</code> found at <code>~/.ipython/profile_pyspark/</code>, edit the file <code>ipython_notebook_config.py</code> with text editor like <code>nano</code> and change the values in the file to resemble values below:  </p>
<pre class="highlight plaintext">c.NotebookApp.ip = '*'
c.NotebookApp.open_browser = False
c.NotebookApp.port = 8889
c.NotebookApp.notebook_dir = u'/usr/hdp/current/spark-client/'
</pre>

<p>Note the port we are using for IPython. Ensure this port is not already being used. The default port for IPython notebook is <code>8888</code>, which is also being used by Sandbox as it&rsquo;s welcome page. So we are changing it to <code>8889</code>. We are going to forward this port in the next section to ensure we can access IPython notebook from the host machine.</p>

<p><img src="https://www.dropbox.com/s/xcdasm4tmmnyibi/Screenshot%202015-07-20%2011.10.50.png?dl=1" /></p>

<p>Next we are going to create a shell script to set the appropriate values everytime we want to start IPython.</p>

<p>Create a shell script with the following command:</p>
<pre class="highlight shell">nano ~/start_ipython_notebook.sh
</pre>

<p>Then copy the following lines into the file:</p>
<pre class="highlight shell"><span class="c">#!/bin/bash</span>
<span class="nb">source</span> /opt/rh/python27/enable
<span class="nv">IPYTHON_OPTS</span><span class="o">=</span><span class="s2">"notebook --profile pyspark"</span> pyspark
</pre>

<p><img src="https://www.dropbox.com/s/r9sagxlzixee8mk/Screenshot%202015-07-20%2011.15.27.png?dl=1" /></p>

<p>Finally we need to make the shell script we just created executable:</p>
<pre class="highlight shell">chmod +x start_ipython_notebook.sh
</pre>

<p><img src="https://www.dropbox.com/s/ofqdaeuevnk05mo/Screenshot%202015-07-20%2011.17.19.png?dl=1" /></p>

<h3>Port Forwarding</h3>

<p>We need to forward the port <code>8889</code> from the guest VM, Sandbox to the host machine, your desktop for IPython notebook to be accessible from a browser on your host machine.</p>

<p>Open the VirtualBox App and open the settings page of the Sandbox VM by right clicking on the Sandbox VM and selecting settings.</p>

<p>Then select the networking tab from the top:</p>

<p><img src="https://www.dropbox.com/s/3lcecis4oajtu63/Screenshot%202015-07-20%2011.18.35.png?dl=1" /></p>

<p>Then click on the port forwarding button to configure the port. Add a new port configuration by clicking the <code>+</code> icon on the top right of the page.</p>

<p>Input a name for application, IP and the guest and host ports as per the screenshot below:</p>

<p><img src="https://www.dropbox.com/s/5xr5bprqde2epr6/Screenshot%202015-07-20%2011.20.00.png?dl=1" /></p>

<p>Then press <code>OK</code> to confirm the change in configuration.</p>

<p>Now we are ready to test IPython notebook.</p>

<h3>Running IPython  notebook</h3>

<p>Execute the shell script we created before from the sandbox command prompt using the command below:</p>
<pre class="highlight plaintext">./start_ipython_notebook.sh
</pre>

<p><img src="https://www.dropbox.com/s/phtrtmv6s01g13k/Screenshot%202015-07-20%2011.21.00.png?dl=1" /></p>

<p>Now, open a browser on your host machine and navigate to the URl <a href="http://127.0.0.1:8889">http://127.0.0.1:8889</a> and you should see the screen below:</p>

<p><img src="https://www.dropbox.com/s/2ga17v2a8klpdz9/Screenshot%202015-07-20%2011.22.06.png?dl=1" /></p>

<p>Voila! you have just configured IPython notebook with Apache Spark on you Sandbox.</p>

<p>In the next few tutorials we are going to explore how we can use IPython notebook to analyze and visualize data.</p>

            </div>
            <nav class="main-content-nav clearfix" role="navigation">
              <ul>
                <li><a class="previous" href="022-installing-zeppelin.html">Previous</a></li>
                <li><a class="next" href="028-spark-with-hdp.html">Next</a></li>
              </ul>
            </nav>
          </section>

          <aside class="aside-content" role="complementary">
            <div class="aside-wrapper">

              <div class="block table-of-contents">
                <h3>Table of Contents</h3>
                <nav role="navigation">
                  <ul>
                    <li class='child '><a href="./">Introduction</a></li><li class='child '><a href="001-configuring-hortonwork-sandbox-azure.html">Configuring Hortonworks Sandbox on Azure</a></li><li class='child '><a href="004-installing-apache-spark-1-3-1.html">Installing Apache Spark 1.3.1 on HDP 2.2.4.2</a></li><li class='child '><a href="007-Installing-Spark-1-2.html">Installing Apache Spark 1.2.0 on HDP 2.2</a></li><li class='child '><a href="010-basics-of-programming-apache-spark.html">Basics of programming Apache Spark</a></li><li class='child '><a href="013-scala-primer.html">A short primer on Scala</a></li><li class='child '><a href="016-spark-with-scala.html">Exploring Spark with Scala</a></li><li class='child '><a href="019-hive-orc-spark.html">Using Hive and ORC with Apache Spark</a></li><li class='child '><a href="022-installing-zeppelin.html">Installing and configuring Zeppelin</a></li><li class='child active'><a href="025-ipython-notebook-with-apache-spark.html">Using IPython Notebook with Apache Spark</a></li><li class='child '><a href="028-spark-with-hdp.html">A Lap around Apache Spark 1.3.1 with HDP 2.3</a></li>
                  </ul>
                </nav>
              </div>
              <!--
              <div class="block translations">
                <h3>Book translations</h3>
                <p>This book is translated into 
                  <a href="#">Spanish</a>
                  and <a href="#">English</a>.
                  You can help with more translations <a href="https://github.com/saptak/spark">on Github</a>.
                </p>
              </div>
              -->
            </div><!-- end aside-wrapper -->
          </aside>

        </div><!-- end content-wrapper -->

      <footer class="page-footer">

        <div class="footer-wrapper">
          <!--
          <div class="block downloads">&nbsp;
            <h3>Downloads</h3>
            <p>Download this book in
                <a href="#">PDF</a>, <a href="#">mobi</a>, and <a href="#">epub</a>
              form for free.
            </p>
          </div>
          -->
          <div class="block license">
            <h3>License</h3>
            <p>This book is licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0">Attribution-ShareAlike</a> license.</p>
          </div>

          <div class="block open-source">
            <h3>This book is open source</h3>
            <p>The source of this book is <a href="https://github.com/saptak/spark">hosted on Github</a>. Go, ahead. Check it out.</p>
          </div>

          <small class="small-text">Made with <a href="http://bitbooks.cc">Bitbooks</a></small>

        </div><!-- end footer-wrapper -->

      </footer>


    </div><!-- end page-wrapper -->

    <!-- include scripts just before the close of the body tag -->
    <script src="themes/glide/javascripts/anchor.min.js" type="text/javascript"></script>
    <script src="themes/glide/javascripts/glide.js" type="text/javascript"></script>
  </body>
</html>